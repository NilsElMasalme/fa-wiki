{% extends 'base.html' %}

{% block title %}{{ team.name }} - FAForever Wiki{% endblock %}

{% block content %}
<h1 class="section-title">{{ team.name }}</h1>

{% if team.description %}
<div class="text-content">
    <p>{{ team.description }}</p>
</div>
{% endif %}

<!-- Team Members Section -->
<section class="mt-4" data-section="team-members">
    <h2 class="section-title" style="font-size: 1.5rem;">Team <span>Members</span></h2>

    <div class="team-grid">
        {% for member in members %}
        <div class="team-card editable-content" data-member-id="{{ member.id }}">
            {% if editor_mode %}
            <div class="edit-overlay">
                <button class="edit-overlay-btn edit-btn"
                        hx-get="{{ url_for('api.member_form', member_id=member.id) }}"
                        hx-target="#editModal"
                        hx-swap="innerHTML">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                    </svg>
                </button>
                <button class="edit-overlay-btn delete"
                        hx-delete="{{ url_for('api.delete_member', member_id=member.id) }}"
                        hx-confirm="Remove this member?"
                        hx-target="closest .team-card"
                        hx-swap="outerHTML">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                    </svg>
                </button>
            </div>
            {% endif %}

            <div class="team-card-icon">
                {% if member.avatar_url %}
                <img src="{{ member.avatar_url }}" alt="{{ member.name }}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
                {% else %}
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
                {% endif %}
            </div>
            <h3>{{ member.name }}</h3>
            {% if member.role %}
            <p style="color: var(--accent-orange);">{{ member.role }}</p>
            {% endif %}
            {% if member.description %}
            <p>{{ member.description }}</p>
            {% endif %}
        </div>
        {% endfor %}

        {% if editor_mode %}
        <div class="add-content-placeholder" style="min-height: 200px;"
             hx-get="{{ url_for('api.member_form') }}?team_id={{ team.id }}"
             hx-target="#editModal"
             hx-swap="innerHTML">
            <div class="add-content-placeholder-icon">+</div>
        </div>
        {% endif %}
    </div>
</section>

<!-- Radar Charts Section (for Trainer Team or others) -->
{% if radar_charts %}
<section class="mt-4" data-section="team-radar">
    <h2 class="section-title" style="font-size: 1.5rem;">Skills <span>Overview</span></h2>

    {% for chart in radar_charts %}
    <div class="radar-chart-container editable-content" data-chart-id="{{ chart.id }}">
        {% if editor_mode %}
        <div class="edit-overlay" style="position: absolute; top: 0.5rem; right: 0.5rem; width: auto; height: auto; background: transparent; opacity: 1;">
            <button class="edit-overlay-btn edit-btn"
                    hx-get="{{ url_for('api.radar_form', chart_id=chart.id) }}"
                    hx-target="#editModal"
                    hx-swap="innerHTML">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                </svg>
            </button>
            <button class="edit-overlay-btn delete"
                    hx-delete="{{ url_for('api.delete_radar', chart_id=chart.id) }}"
                    hx-confirm="Delete this chart?"
                    hx-target="closest .radar-chart-container"
                    hx-swap="outerHTML">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                </svg>
            </button>
        </div>
        {% endif %}

        <h3 class="radar-chart-title">{{ chart.title }}</h3>
        <canvas id="radar-{{ chart.id }}" width="400" height="400"></canvas>
    </div>
    {% endfor %}

    {% if editor_mode %}
    <div class="add-content-placeholder"
         hx-get="{{ url_for('api.radar_form') }}?team_id={{ team.id }}"
         hx-target="#editModal"
         hx-swap="innerHTML">
        <div class="add-content-placeholder-icon">+</div>
    </div>
    {% endif %}
</section>
{% endif %}

<!-- Replay Reviews Section (Trainer Team specific) -->
{% if team.slug == 'trainer' %}
<section class="mt-4" data-section="replay-reviews">
    <h2 class="section-title" style="font-size: 1.5rem;">Replay <span>Reviews</span></h2>

    <!-- Filter Bar -->
    <div class="filter-bar">
        <select class="filter-select" id="gamemodeFilter"
                hx-get="{{ url_for('api.reviews') }}"
                hx-trigger="change"
                hx-target="#reviewsContainer"
                hx-include="[name='filter']">
            <option value="">All Gamemodes</option>
            <option value="1v1">1v1</option>
            <option value="2v2">2v2</option>
            <option value="3v3">3v3</option>
            <option value="4v4">4v4</option>
            <option value="setons">Setons</option>
        </select>
        <select class="filter-select" id="timeFilter" name="filter">
            <option value="">All Time</option>
            <option value="week">Last Week</option>
            <option value="month">Last Month</option>
            <option value="year">Last Year</option>
        </select>
    </div>

    <div class="reviews-container" id="reviewsContainer">
        {% for review in reviews %}
        <div class="review-card editable-content" data-review-id="{{ review.id }}">
            {% if editor_mode %}
            <div class="edit-overlay" style="position: absolute; top: 0.5rem; right: 0.5rem; width: auto; height: auto; background: transparent; opacity: 1;">
                <button class="edit-overlay-btn edit-btn"
                        hx-get="{{ url_for('api.review_form', review_id=review.id) }}"
                        hx-target="#editModal"
                        hx-swap="innerHTML">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                    </svg>
                </button>
                <button class="edit-overlay-btn delete"
                        hx-delete="{{ url_for('api.delete_review', review_id=review.id) }}"
                        hx-confirm="Delete this review?"
                        hx-target="closest .review-card"
                        hx-swap="outerHTML">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                    </svg>
                </button>
            </div>
            {% endif %}

            <div class="review-header">
                <h3 class="review-title">{{ review.title }}</h3>
                <div class="review-meta">
                    {% if review.gamemode %}<span>{{ review.gamemode }}</span>{% endif %}
                    {% if review.map_name %}<span>{{ review.map_name }}</span>{% endif %}
                    <span>{{ review.published_at.strftime('%Y-%m-%d') }}</span>
                </div>
            </div>
            <div class="review-content">
                {{ review.content_html|safe }}
            </div>
            {% if review.author %}
            <p style="margin-top: 1rem; color: var(--text-muted); font-size: 0.85rem;">
                - {{ review.author }}
            </p>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    {% if editor_mode %}
    <div class="add-content-placeholder mt-2"
         hx-get="{{ url_for('api.review_form') }}"
         hx-target="#editModal"
         hx-swap="innerHTML">
        <div class="add-content-placeholder-icon">+</div>
    </div>
    {% endif %}
</section>
{% endif %}

<div id="editModal"></div>
{% endblock %}

{% block scripts %}
{% if radar_charts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Initialize radar charts
    {% for chart in radar_charts %}
    new Chart(document.getElementById('radar-{{ chart.id }}'), {
        type: 'radar',
        data: {
            labels: {{ chart.get_axes()|tojson }},
            datasets: [{
                data: {{ chart.get_data()|tojson }},
                backgroundColor: 'rgba(255, 140, 0, 0.2)',
                borderColor: 'rgba(255, 140, 0, 1)',
                borderWidth: 2,
                pointBackgroundColor: 'rgba(255, 140, 0, 1)'
            }]
        },
        options: {
            scales: {
                r: {
                    beginAtZero: true,
                    max: 100,
                    ticks: { color: '#b0b0b0' },
                    grid: { color: '#333' },
                    angleLines: { color: '#333' },
                    pointLabels: { color: '#fff' }
                }
            },
            plugins: {
                legend: { display: false }
            }
        }
    });
    {% endfor %}
</script>
{% endif %}
{% endblock %}
